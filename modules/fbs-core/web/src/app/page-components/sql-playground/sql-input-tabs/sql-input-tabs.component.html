<mat-card-actions>
  <mat-tab-group
    [selectedIndex]="activeTabId.value"
    (selectedIndexChange)="activeTabId.setValue($event)"
    [backgroundColor]=""
  >
    <ng-container>
      <mat-tab *ngFor="let tab of tabs; let index = index">
        <ng-template [mat-tab-label]>
          <div class="col" style="margin-left: 20px">
            <input
              matInput
              type="text"
              placeholder="New_Query"
              [(ngModel)]="tabs[index].name"
            />
          </div>
          <button *ngIf="index !== 0" mat-icon-button (click)="closeTab(index)">
            <mat-icon>remove_circle_outline</mat-icon>
          </button>
          <button mat-icon-button (click)="addTab()">
            <mat-icon>add_circle_outline</mat-icon>
          </button>
        </ng-template>
        <div class="inputField">
          <app-submission-text
            (update)="updateSubmissionContent($event)"
          ></app-submission-text>
        </div>
      </mat-tab>
    </ng-container>
  </mat-tab-group>
  <p class="description" *ngIf="selectedTask != null && isDescriptionMode">
    <strong>Aufgabenbeschreibung:</strong> {{ selectedTask.description }}
  </p>
  <div class="bottom-container">
    <button mat-button class="downloadBtn" (click)="downloadFile()">
      <mat-icon>download</mat-icon> Download
    </button>

    <button
      [disabled]="isSubmissionEmpty()"
      mat-flat-button
      color="accent"
      class="excuteBtn"
      (click)="submission()"
    >
      <span class="spinner" *ngIf="pending">
        <mat-spinner [diameter]="24"></mat-spinner>&nbsp;
      </span>
      <span *ngIf="!pending">Ausführen</span>
    </button>

    <button
      mat-flat-button
      class="submitBtn"
      *ngIf="!submitModeActive"
      matTooltip="Wähle eine Aufgabe aus deinem Kurs und gebe das Statement direkt ab."
      [matTooltipPosition]="'above'"
      (click)="updateMode(true)"
    >
      Abgeben<mat-icon>insert_drive_file</mat-icon>
    </button>

    <button
      *ngIf="submitModeActive"
      [disabled]="isSubmissionEmpty() || hasDeadlinePassed()"
      mat-flat-button
      color="accent"
      class="excuteBtn"
      (click)="submissionToTask()"
    >
      <span class="spinner" *ngIf="pending">
        <mat-spinner [diameter]="24"></mat-spinner>&nbsp;
      </span>
      <span *ngIf="!pending">Abgeben</span>
    </button>

    <mat-icon
      [ngStyle]="{ color: isDescriptionMode == true ? 'black' : 'grey' }"
      class="material-icons.color_green"
      matTooltip="Beschreibung anzeigen"
      *ngIf="submitModeActive"
      (click)="isDescriptionMode = !isDescriptionMode"
      >remove_red_eye</mat-icon
    >

    <mat-icon matTooltip="Status der Abgabe" *ngIf="submitModeActive && !wasSubmissionCorrect()"
      >cancel</mat-icon
    >
    <mat-icon matTooltip="Status der Abgabe" *ngIf="submitModeActive && wasSubmissionCorrect()"
      >check_circle</mat-icon
    >

    <button
      class="courseBtn"
      *ngIf="submitModeActive"
      mat-button
      [matMenuTriggerFor]="task"
    >
      {{ selectedTaskName }} <mat-icon>expand_more</mat-icon>
    </button>
    <mat-menu #task="matMenu">
      <button
        (click)="changeTask(task)"
        mat-menu-item
        *ngFor="let task of tasks | async"
      >
        {{ task.name }}
      </button>
    </mat-menu>

    <button
      class="courseBtn"
      *ngIf="submitModeActive"
      mat-button
      [matMenuTriggerFor]="course"
    >
      {{ selectedCourseName }} <mat-icon>expand_more</mat-icon>
    </button>
    <mat-menu #course="matMenu">
      <button
        (click)="changeCourse(course)"
        mat-menu-item
        *ngFor="let course of filteredCourses | async"
      >
        {{ course.name }}
      </button>
    </mat-menu>

    <button
      *ngIf="submitModeActive"
      class="closeBtn"
      mat-flat-button
      (click)="updateMode(false)"
    >
      <mat-icon>closeTab</mat-icon>
    </button>
  </div>
</mat-card-actions>
