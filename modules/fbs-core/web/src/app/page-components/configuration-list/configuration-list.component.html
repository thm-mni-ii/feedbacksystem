<div class="container">
  <app-menu-bar>
    <button
      mat-icon-button
      [routerLink]="['/courses', courseId, 'task', taskId]"
      matTooltip="{{ 'configuration.back-to-task' | i18nextEager }}"
    >
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="spacer"></span>
  </app-menu-bar>

  <div class="create-button">
    <button
      mat-raised-button
      color="accent"
      *ngIf="isAuthorized()"
      (click)="addConfig()"
      matTooltip="{{ 'configuration.add-checker' | i18nextEager }}"
    >
      <mat-icon>add</mat-icon>&nbsp;{{
        "configuration.add-checker" | i18nextEager
      }}
    </button>
  </div>

  <mat-card class="card settings-card">
    <div class="settings-card__header">
      <div>
        <h3>{{ "configuration.staged-feedback.title" | i18nextEager }}</h3>
        <p>{{ "configuration.staged-feedback.hint" | i18nextEager }}</p>
      </div>
      <mat-slide-toggle
        color="primary"
        [(ngModel)]="stagedFeedbackConfig.enabled"
        (change)="saveStagedConfig()"
      >
        {{ "configuration.staged-feedback.toggle" | i18nextEager }}
      </mat-slide-toggle>
    </div>
    <div class="settings-card__content" *ngIf="stagedFeedbackConfig.enabled">
      <div class="staged-control">
        <span class="staged-control-label">{{
          "configuration.staged-feedback.limit-label" | i18nextEager
        }}</span>
        <div class="staged-control-input">
          <button
            mat-icon-button
            color="primary"
            (click)="adjustLimit(-1)"
            [disabled]="stagedFeedbackConfig.initialOrdLimit <= 1"
            matTooltip="Reduzieren"
          >
            <mat-icon>expand_more</mat-icon>
          </button>
          <div class="value">
            {{ stagedFeedbackConfig.initialOrdLimit }}
          </div>
          <button
            mat-icon-button
            color="primary"
            (click)="adjustLimit(1)"
            [disabled]="stagedFeedbackConfig.initialOrdLimit >= maxOrder"
            matTooltip="ErhÃ¶hen"
          >
            <mat-icon>expand_less</mat-icon>
          </button>
        </div>
      </div>
      <div class="staged-control-hint">
        {{ "configuration.staged-feedback.limit-hint" | i18nextEager }}
      </div>
    </div>
  </mat-card>

  <ng-container *ngFor="let configuration of configurations | async">
    <mat-card class="card">
      <div class="checker-info">
        <span *ngIf="stagedFeedbackConfig.enabled" class="checker-order"
          >#{{ configuration.ord }}</span
        >
        <span>{{ configuration.checkerType }}</span>
      </div>

      <span class="spacer"></span>

      <button
        mat-icon-button
        color="primary"
        [disabled]="!configuration.mainFileUploaded"
        (click)="downloadMainFile(configuration)"
        matTooltip="{{ 'configuration.download-primary-file' | i18nextEager }}"
      >
        <mat-icon>save_alt</mat-icon>
      </button>
      <button
        mat-icon-button
        color="primary"
        [disabled]="!configuration.secondaryFileUploaded"
        (click)="downloadSecondaryFile(configuration)"
        matTooltip="{{
          'configuration.download-secondary-file' | i18nextEager
        }}"
      >
        <mat-icon>save_alt</mat-icon>
      </button>

      <button
        mat-icon-button
        color="primary"
        (click)="editConfig(configuration)"
        matTooltip="{{ 'configuration.edit-checker' | i18nextEager }}"
      >
        <mat-icon>edit</mat-icon>
      </button>
      <button
        mat-icon-button
        color="primary"
        (click)="deleteConfig(configuration)"
        matTooltip="{{ 'configuration' | i18nextEager }}"
      >
        <mat-icon>delete</mat-icon>
      </button>
    </mat-card>
    <div
      *ngIf="
        stagedFeedbackConfig.enabled &&
        configuration.ord === stagedFeedbackConfig.initialOrdLimit
      "
      class="staged-divider"
    ></div>
  </ng-container>
</div>
